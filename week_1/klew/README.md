# 웹 어플리케이션의 이해

### 웹서버

HTML, CSS, jpeg 같은 정적리소스를 처리하는 장소입니다. 그래서 특정사용자에게 다른 페이지를 보여주지 않습니다.

### WAS (웹 애플리케이션 서버)

HTTP 프로토콜을 기반으로 동적리소스를 처리하는 장소입니다. 그래서 특정사용자마다 다른 페이지를 보여줍니다. JSP와 Servlet을 실행하는 SW를 '웹 컨테이너'라고 하는데 웹서버와 웹컨테이너를 합친것을 WAS라고 합니다. <br>
(사실 둘의 경계는 모호한 점이 웹서버도 프로그램의 기능을 제공하기도 WAS도 웹서버의 기능을 제공합니다.) <br>

다만 웹 시스템 구성을 WAS, DB로만 구성하면 WAS가 너무 많은 역할을 담당하게 되서 별도의 웹서버를 두고 정적처리는 웹서버가, 동적처리는 WAS가 처리하도록 하여 병렬적으로 운영합니다.<br>

예를 들면, 동일한 데이터를 반복해서 접근해야 하거나 많은 용량이 필요한 파일(동영상 or 이미지)을 별도의 서버에 저장하는 것을 '캐싱'이라고 합니다. 클라이언트와 가장 가까운 서버에 캐싱서버를 두어 원본 서버의 부하를 줄이는 기술을 "CDN"이라고 합니다.<br>

### 서블릿 컨테이너 (Servlet Container)

서블릿을 지원하는 WAS를 서블릿 컨테이너라고 합니다. WAS는 클라이언트의 요청에 맞춰 HttpServletRequest, HttpServletResponse 객체를 만들어 서블릿 컨테이너에 보내면 개발자는 그 객체에 응답정보를 입력합니다.<br>

**서블릿 컨테이너의 주요기능** <br>

1. 서블릿 생명주기 관리
   > 서블릿 클래스가 로딩되어 인스턴스화 되고 초기화 메서드를 호출합니다. 요청이 들어오게 되면 그에 맞는 서블릿 클래스를 호출합니다. WAS가 종료되거나 서블릿의 수명이 다 할 경우에 가비지 컬렉션을 통해 메모리해제를 합니다.
2. 웹서버 통신 지원
   > 클라이언트의 request를 받아주고 response를 보낼 수 있게 웹 서버와 소켓을 만들어 웹서버와 소켓을 생성해 통신을 해줍니다.
3. 멀티쓰레드
   > 서블릿 객체 호출은 쓰레드가 합니다. 그래서 request가 올 때마다 원래는 새로운 쓰레드를 생성하고 HTTP메소드가 실행되고 나면 쓰레드는 소멸하게 됩니다. 하지만 서버가 다중 쓰레드를 관리한다고 해서 안심할 수 없습니다. <br>
   > 왜냐하면 쓰레드의 생성비용이 크고 코어가 쓰레드전환을 하면서 생기는 컨텍스트 스위치 비용이 발생할 수 있기 때문입니다. 쓰레드가 너무 많이 생성되면 CPU, 메모리, 서버 등이 터질 수 있습니다.
4. 선언적인 보안관리
   > 서블릿 컨테이너는 기본적으로 보안 관련 기능을 제공하여 자바클래스 안에 보안과 관련한 메소드를 구현할 필요가 없습니다. 대부분의 보안 관리는 XML 배포서술자에 기록하기 때문에 보안이슈로 인한 수정사항이 생겨도 자바소스코드를 다시 컴파일 할 필요는 없습니다.

**쓰레드 풀 (Thread Pool)** <br>
서블릿을 멀티쓰레드로 관리를 하게 되면 웹사이트에서 수강신청이나 할인쿠폰행사 같은 이벤트를 하여 큰 트래픽이 생겼을 때 서버가 다운 될 수 있는 위험이 있습니다. 이를 보완하기 위해 쓰레드를 여러개 생성하여 미리 생성된 쓰레드를 요청이 올 때마다 가져다 쓰는 패턴을 "쓰레드 풀"이라고 합니다.<br>

생성된 쓰레드보다 요청이 많게 되면 쓰레드가 반납될 때까지 대기하거나 거절할 수 있습니다. 이렇게 임계치를 낮게 두게 되면 트래픽 관리를 쉽게 할 수 있는 장점이 있지만 클라이언트의 대기시간이 길어질 수 있습니다. 반대로 임계치를 높게 두면 서버가 다운될 수 있는 문제가 있습니다. 그래서 어플리케이션 로직 복잡도, CPU, 메모리, IO 리소스 상황을 고려한 성능테스트를 통해 적정숫자를 찾는 것이 중요합니다. (Tool: 아파치 ab, 제이미터, nGrinder)<br>

**서블릿 (Servlet)** <br>
WAS가 비즈니스 로직(데이터베이스에 저장요청같은)에 집중할 수 있도록 HTTP 파싱과 request와 response를 웹 브라우저에게 전달하는 웹 어플리케이션 컴포넌트입니다.

```
@WebServlet(name = "responseHeaderServlet", urlPatterns = "/response-header")
// urlPatterns(/hello)의 URL이 호출되면 서블릿 코드가 실행된다.
```
